#include "lap.h"
#include "CLCD.h"

extern Lap lap;
extern Stopwatch stopwatch;
extern CLCD clcd;

void lap_measure()
{
	if(lap.count == 9) sprintf(clcd.str2, "LAP FULL(9/9)   ");
	else
	{
		lap.record[lap.count].hour = stopwatch.time.hour;
		lap.record[lap.count].minute = stopwatch.time.minute;
		lap.record[lap.count].second = stopwatch.time.second;
		lap.record[lap.count].milisecond = stopwatch.time.milisecond;

		sprintf(clcd.str2, "LP%1d %02d:%02d:%02d.%03d",
				lap.count + 1,
				lap.record[lap.count].hour,
				lap.record[lap.count].minute,
				lap.record[lap.count].second,
				lap.record[lap.count].milisecond);

		lap.count++;
	}

	CLCD_Puts(0, 1, clcd.str2);
	lap.show_num = 0;
	lap.state = READY;
}

void lap_display_record()
{
	if(lap.count == 0) sprintf(clcd.str2, "NO LAP          ");
	else
	{
		if(lap.show_num == lap.count) lap.show_num = 0;
		sprintf(clcd.str2, "%d/%d %02d:%02d:%02d.%03d",
				lap.show_num + 1,
				lap.count,
				lap.record[lap.show_num].hour,
				lap.record[lap.show_num].minute,
				lap.record[lap.show_num].second,
				lap.record[lap.show_num].milisecond);

		lap.show_num++;
	}

	CLCD_Puts(0, 1, clcd.str2);
	lap.state = READY;
}

void lap_clear()
{
	lap.count = 0;
	lap.show_num = 0;
	CLCD_Clear();

	sprintf(clcd.str1, "STW 00:00:00.000");
	CLCD_Puts(0, 0, clcd.str1);
	lap.state = READY;
}
